#!/bin/sh

sudo apt-get install python-setuptools python-dev build-essential python-tk
sudo easy_install pip
pip2 install -r requirements.txt

# install docker
sudo apt-get remove docker docker-engine docker.io
sudo apt-get update
sudo apt-get install -y \
    linux-image-extra-$(uname -r | sed 's/-aws$//') \
    linux-image-extra-virtual
sudo apt-get update
sudo apt-get install -y \
    apt-transport-https \
    ca-certificates \
    curl \
    software-properties-common
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
sudo apt-key fingerprint 0EBFCD88
sudo add-apt-repository \
   "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   $(lsb_release -cs) \
   stable"
sudo apt-get update
sudo apt-get install -y docker-ce

# nvidia-docker
wget -P /tmp https://github.com/NVIDIA/nvidia-docker/releases/download/v1.0.1/nvidia-docker_1.0.1-1_amd64.deb
sudo dpkg -i /tmp/nvidia-docker*.deb && rm /tmp/nvidia-docker*.deb

if [ ! -d "models" ]; then
    mkdir models
    wget https://nofile.io/f/X30qy6yyC7O/hopenet_alpha1.pkl -P models
    wget https://nofile.io/f/H8gXGzeXJAw/hopenet_alpha2.pkl -P models
    wget https://nofile.io/f/MD1PKqdRA6Q/hopenet_robust_alpha1.pkl -P models
fi

if [ ! -d "data" ]; then
    mkdir data
fi

if [ ! -d "output" ]; then
    mkdir output
fi
